>  é‡ç‚¹æŒæ¡ï¼šé€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼ï¼Œæ¨¡æ¿æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼
>
>  springï¼šé€‚é…å™¨æ¨¡å¼ï¼ˆsprngmvcï¼‰ï¼Œä»£ç†æ¨¡å¼(AOP)ï¼Œå·¥å‚æ¨¡å¼(BeanFactory)ï¼Œå•ä¾‹æ¨¡å¼

[æ¨èåšå®¢](https://www.cnblogs.com/WindSun/category/1376525.html)



# ğŸƒ åˆ›å»ºå‹

## 1 å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰
æŒ‡ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸”è¯¥ç±»èƒ½è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹çš„ä¸€ç§æ¨¡å¼ã€‚


good:
1.åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å®ä¾‹
2.é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰ã€‚
bad:
1.æ²¡æœ‰æ¥å£ï¼Œä¸èƒ½ç»§æ‰¿ï¼Œä¸å•ä¸€èŒè´£åŸåˆ™å†²çªï¼Œä¸€ä¸ªç±»åº”è¯¥åªå…³å¿ƒå†…éƒ¨é€»è¾‘ï¼Œè€Œä¸å…³å¿ƒå¤–é¢æ€ä¹ˆæ ·æ¥å®ä¾‹åŒ–ã€‚

å•ä¾‹æ¨¡å¼æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š  

1. å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚  
2. å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚  
3. å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚ 


é€‚ç”¨åœºæ™¯ï¼š

åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ± ã€ç¼“å­˜ã€æ—¥å¿—å¯¹è±¡ã€å¯¹è¯æ¡†ã€æ‰“å°æœºã€æ˜¾å¡çš„é©±åŠ¨ç¨‹åºå¯¹è±¡å¸¸è¢«è®¾è®¡æˆå•ä¾‹ã€‚è¿™äº›åº”ç”¨éƒ½æˆ–å¤šæˆ–å°‘å…·æœ‰èµ„æºç®¡ç†å™¨çš„åŠŸèƒ½ã€‚



### 

### 1.1 æ‡’æ±‰å¼

#### 1.1.1 çº¿ç¨‹ä¸å®‰å…¨

ä»¥ä¸‹å®ç°ä¸­ï¼Œç§æœ‰é™æ€å˜é‡ singleè¢«å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°è¯¥ç±»ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå®ä¾‹åŒ– singleï¼Œä»è€ŒèŠ‚çº¦èµ„æºã€‚

è¿™ä¸ªå®ç°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶è¿›å…¥ `if (single== null)` ï¼Œå¹¶ä¸”æ­¤æ—¶ singleä¸º nullï¼Œé‚£ä¹ˆä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ‰§è¡Œ `single= new Singleton();` è¯­å¥ï¼Œè¿™å°†å¯¼è‡´å®ä¾‹åŒ–å¤šæ¬¡ Singletonã€‚

```java
public class Singleton {
    private static Singleton single=null;
    private Singleton() {}
    //é™æ€å·¥å‚æ–¹æ³• 
    public static Singleton getInstance() {
         if (single == null) {  
             single = new Singleton();
         }  
        return single;
    }
}
```
```go
package singleton
import "sync"

var (
    instance *Instance
    lock     sync.Mutex
)

type Instance struct {
    Name string
}

// åŒé‡æ£€æŸ¥
func GetInstance(name string) *Instance {
    if instance == nil {
        lock.Lock()
        defer lock.Unlock()
        if instance == nil {
            instance = &Instance{Name: name}
        }
    }
    return instance
}
```


#### 1.1.3 åŒé‡æ ¡éªŒé”-çº¿ç¨‹å®‰å…¨

singleåªéœ€è¦è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚åŠ é”æ“ä½œåªéœ€è¦å¯¹å®ä¾‹åŒ–é‚£éƒ¨åˆ†çš„ä»£ç è¿›è¡Œï¼Œåªæœ‰å½“ singleæ²¡æœ‰è¢«å®ä¾‹åŒ–æ—¶ï¼Œæ‰éœ€è¦è¿›è¡ŒåŠ é”ã€‚

åŒé‡æ ¡éªŒé”å…ˆåˆ¤æ–­ singleæ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆæ‰å¯¹å®ä¾‹åŒ–è¯­å¥è¿›è¡ŒåŠ é”ã€‚

```java
 public class Singleton {
    private volatile static Singleton single=null;
    private Singleton() {}
     
   public static Singleton getInstance() {
        if (single == null) {  
            synchronized (Singleton.class) {  
               if (single == null) {  
                  single = new Singleton(); 
               }  
            }  
        }  
        return single; 
    }
}
```
#


#### 1.1.4 é™æ€å†…éƒ¨ç±»å®ç°

å½“ Singleton ç±»è¢«åŠ è½½æ—¶ï¼Œé™æ€å†…éƒ¨ç±» LazyHolderæ²¡æœ‰è¢«åŠ è½½è¿›å†…å­˜ã€‚åªæœ‰å½“è°ƒç”¨ `getInstance()` æ–¹æ³•ä»è€Œè§¦å‘ `LazyHolder.INSTANCE` æ—¶ LazyHolder æ‰ä¼šè¢«åŠ è½½ï¼Œæ­¤æ—¶åˆå§‹åŒ– INSTANCE å®ä¾‹ï¼Œå¹¶ä¸” JVM èƒ½ç¡®ä¿ INSTANCE åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚

è¿™ç§æ–¹å¼ä¸ä»…å…·æœ‰å»¶è¿Ÿåˆå§‹åŒ–çš„å¥½å¤„ï¼Œè€Œä¸”ç”± JVM æä¾›äº†å¯¹çº¿ç¨‹å®‰å…¨çš„æ”¯æŒã€‚

>è¿™ç§æ¯”ä¸Šé¢sychronizedå’ŒåŒé‡æ£€ç´¢é”æ–¹æ³•éƒ½å¥½ä¸€äº›ï¼Œæ—¢å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆé¿å…äº†åŒæ­¥å¸¦æ¥çš„æ€§èƒ½å½±å“ã€‚ 

```java
public class Singleton {  
    private static class LazyHolder {  
       private static final Singleton INSTANCE = new Singleton();  
    }  
    private Singleton (){}  
    public static final Singleton getInstance() {  
       return LazyHolder.INSTANCE;  
    }  
}  
```

#### 1.1.5 è¯­è¨€é£æ ¼çš„å•ä¾‹æ¨¡å¼
```go
package singleton

import "sync"

var (
    goInstance *Instance
    once       sync.Once
)

// ä½¿ç”¨go å®ç°å•ä¾‹æ¨¡å¼
func GoInstance(name string) *Instance {
    if goInstance == nil {
        once.Do(func() {
            goInstance = &Instance{
                Name: name,
            }
        })
    }
    return goInstance
}
```

### 1.2 é¥¿æ±‰å¼-çº¿ç¨‹å®‰å…¨

çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯ç”±äº singleè¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œé‡‡å–ç›´æ¥å®ä¾‹åŒ– single çš„æ–¹å¼å°±ä¸ä¼šäº§ç”Ÿçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚

ä½†æ˜¯ç›´æ¥å®ä¾‹åŒ–çš„æ–¹å¼ä¹Ÿä¸¢å¤±äº†å»¶è¿Ÿå®ä¾‹åŒ–å¸¦æ¥çš„èŠ‚çº¦èµ„æºçš„å¥½å¤„ã€‚

```java
//é¥¿æ±‰å¼å•ä¾‹ç±».åœ¨ç±»åˆå§‹åŒ–æ—¶ï¼Œå·²ç»è‡ªè¡Œå®ä¾‹åŒ– 
public class Singleton1 {
    private Singleton1() {}
    private static final Singleton1 single = new Singleton1();
    //é™æ€å·¥å‚æ–¹æ³• 
    public static Singleton1 getInstance() {
        return single;
    }
}
```



## 2 å·¥å‚æ¨¡å¼

  å·¥å‚æ¨¡å¼ä¸»è¦æ˜¯ä¸ºåˆ›å»ºå¯¹è±¡æä¾›è¿‡æ¸¡æ¥å£ï¼Œä»¥ä¾¿å°†åˆ›å»ºå¯¹è±¡çš„å…·ä½“è¿‡ç¨‹å±è”½éš”ç¦»èµ·æ¥ï¼Œè¾¾åˆ°æé«˜çµæ´»æ€§çš„ç›®çš„ã€‚ 
å·¥å‚æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š 

1. ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰ 

2. å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰ 
3. æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰ 

è¿™ä¸‰ç§æ¨¡å¼ä»ä¸Šåˆ°ä¸‹é€æ­¥æŠ½è±¡ï¼Œå¹¶ä¸”æ›´å…·ä¸€èˆ¬æ€§ã€‚ 
GOFåœ¨ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­å°†å·¥å‚æ¨¡å¼åˆ†ä¸ºä¸¤ç±»ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ä¸æŠ½è±¡å·¥å‚æ¨¡å¼

å°†ç®€å•å·¥å‚æ¨¡å¼çœ‹ä¸ºå·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä¸¤è€…å½’ä¸ºä¸€ç±»ã€‚ 



**åŒºåˆ« ï¼š**

* å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š

  ä¸€ä¸ªæŠ½è±¡äº§å“ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚   
  ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚   
  æ¯ä¸ªå…·ä½“å·¥å‚ç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚

* æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š

  å¤šä¸ªæŠ½è±¡äº§å“ç±»ï¼Œæ¯ä¸ªæŠ½è±¡äº§å“ç±»å¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚   
  ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚   
  æ¯ä¸ªå…·ä½“å·¥å‚ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚   



### 2.1 ç®€å•å·¥å‚æ¨¡å¼

### intent

ç®€å•å·¥å‚æŠŠå®ä¾‹åŒ–çš„æ“ä½œå•ç‹¬æ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œè¿™ä¸ªç±»å°±æˆä¸ºç®€å•å·¥å‚ç±»ï¼Œè®©ç®€å•å·¥å‚ç±»æ¥å†³å®šåº”è¯¥ç”¨å“ªä¸ªå…·ä½“å­ç±»æ¥å®ä¾‹åŒ–ã€‚
å¦‚æœåœ¨æŠ½è±¡ç±»ä¸­é™åˆ¶æ¥å£çš„åŒ–ï¼Œè¿˜å¯ä»¥èµ·åˆ°çº¦æŸæ¥å£çš„ä½œç”¨ã€‚ç»Ÿä¸€åˆ›å»ºï¼Œç›¸åŒçš„ä½¿ç”¨ã€‚

### Class Diagram

![](./assets/1.1.png)



### Implementation

äº§å“ç±»ï¼š 

```java
abstract class BMW {
	public BMW(){
		
	}
}
```

```java
public class BMW320 extends BMW {
	public BMW320() {
		System.out.println("åˆ¶é€ -->BMW320");
	}
}
public class BMW523 extends BMW{
	public BMW523(){
		System.out.println("åˆ¶é€ -->BMW523");
	}
}
```


å·¥å‚ç±»ï¼š 

```java
public class Factory {
	public BMW createBMW(int type) {
		switch (type) {
		
		case 320:
			return new BMW320();
 
		case 523:
			return new BMW523();
 
		default:
			break;
		}
		return null;
	}
}
```

å®¢æˆ·ç±»ï¼š 

```java
public class Customer {
	public static void main(String[] args) {
		Factory factory = new Factory();
		BMW bmw320 = factory.createBMW(320);
		BMW bmw523 = factory.createBMW(523);
	}
}
```



### 2.2 å·¥å‚æ–¹æ³•æ¨¡å¼

### intent

å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„å·¥å‚æ¥å£ï¼Œå·¥å‚æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æŠŠå®ä¾‹åŒ–æ“ä½œæ¨è¿Ÿåˆ°å­ç±»ã€‚

ä¸ç®€å•å·¥å‚ä¸åŒï¼Œè¿™é‡Œç»™å·¥å‚å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”å®šä¹‰äº†å¤šä¸ªä¸åŒå·¥å‚ï¼Œæ¯ä¸ªå·¥å‚è´Ÿè´£ä¸€æ¬¾äº§å“ã€‚


### Class Diagram


![](./assets/1.2.png)


### Implementation

```java

public interface IRuleConfigParserFactory {
  IRuleConfigParser createParser();
}

public class JsonRuleConfigParserFactory implements IRuleConfigParserFactory {
  @Override
  public IRuleConfigParser createParser() {
    return new JsonRuleConfigParser();
  }

}


public class RuleConfigSource {
  public RuleConfig load(String ruleConfigFilePath) {
    String ruleConfigFileExtension = getFileExtension(ruleConfigFilePath);

    IRuleConfigParserFactory parserFactory = RuleConfigParserFactoryMap.getParserFactory(ruleConfigFileExtension);
    if (parserFactory == null) {
      throw new InvalidRuleConfigException("Rule config file format is not supported: " + ruleConfigFilePath);
    }
    IRuleConfigParser parser = parserFactory.createParser();

    String configText = "";
    //ä»ruleConfigFilePathæ–‡ä»¶ä¸­è¯»å–é…ç½®æ–‡æœ¬åˆ°configTextä¸­
    RuleConfig ruleConfig = parser.parse(configText);
    return ruleConfig;
  }

  private String getFileExtension(String filePath) {
    //...è§£ææ–‡ä»¶åè·å–æ‰©å±•åï¼Œæ¯”å¦‚rule.jsonï¼Œè¿”å›json
    return "json";
  }
}

//å› ä¸ºå·¥å‚ç±»åªåŒ…å«æ–¹æ³•ï¼Œä¸åŒ…å«æˆå‘˜å˜é‡ï¼Œå®Œå…¨å¯ä»¥å¤ç”¨ï¼Œ
//ä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„å·¥å‚ç±»å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œç®€å•å·¥å‚æ¨¡å¼çš„ç¬¬äºŒç§å®ç°æ€è·¯æ›´åŠ åˆé€‚ã€‚
public class RuleConfigParserFactoryMap { //å·¥å‚çš„å·¥å‚
  private static final Map<String, IRuleConfigParserFactory> cachedFactories = new HashMap<>();

  static {
    cachedFactories.put("json", new JsonRuleConfigParserFactory());
    cachedFactories.put("xml", new XmlRuleConfigParserFactory());
    cachedFactories.put("yaml", new YamlRuleConfigParserFactory());
    cachedFactories.put("properties", new PropertiesRuleConfigParserFactory());
  }

  public static IRuleConfigParserFactory getParserFactory(String type) {
    if (type == null || type.isEmpty()) {
      return null;
    }
    IRuleConfigParserFactory parserFactory = cachedFactories.get(type.toLowerCase());
    return parserFactory;
  }
}
```


### ä½¿ç”¨åœºæ™¯
1.ç±»ä¼¼è§„åˆ™é…ç½®è§£æçš„ä¾‹å­ï¼Œä»£ç ä¸­å­˜åœ¨ if-else åˆ†æ”¯åˆ¤æ–­ï¼ŒåŠ¨æ€åœ°æ ¹æ®ä¸åŒçš„ç±»å‹åˆ›å»ºä¸åŒçš„å¯¹è±¡ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±è€ƒè™‘ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œå°†è¿™ä¸€å¤§å¨ if-else åˆ›å»ºå¯¹è±¡çš„ä»£ç æŠ½ç¦»å‡ºæ¥ï¼Œæ”¾åˆ°å·¥å‚ç±»ä¸­ã€‚
2.è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°½ç®¡æˆ‘ä»¬ä¸éœ€è¦æ ¹æ®ä¸åŒçš„ç±»å‹åˆ›å»ºä¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œå•ä¸ªå¯¹è±¡æœ¬èº«çš„åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„è¦ç»„åˆå…¶ä»–ç±»å¯¹è±¡ï¼Œåšå„ç§åˆå§‹åŒ–æ“ä½œã€‚æ¨èä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼


# :christmas_tree: è¡Œä¸ºå‹

## 1 è§‚å¯Ÿè€…

### Intent

è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ã€‚ 



### Class Diagram

ä¸»é¢˜ï¼ˆSubjectï¼‰å…·æœ‰æ³¨å†Œå’Œç§»é™¤è§‚å¯Ÿè€…ã€å¹¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„åŠŸèƒ½ï¼Œä¸»é¢˜æ˜¯é€šè¿‡ç»´æŠ¤ä¸€å¼ è§‚å¯Ÿè€…åˆ—è¡¨æ¥å®ç°è¿™äº›æ“ä½œçš„ã€‚

è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„æ³¨å†ŒåŠŸèƒ½éœ€è¦è°ƒç”¨ä¸»é¢˜çš„ registerObserver() æ–¹æ³•ã€‚

![](./assets/1.13.png) </div><br>

### Implementation

å¤©æ°”æ•°æ®å¸ƒå‘Šæ¿ä¼šåœ¨å¤©æ°”ä¿¡æ¯å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°å…¶å†…å®¹ï¼Œå¸ƒå‘Šæ¿æœ‰å¤šä¸ªï¼Œå¹¶ä¸”åœ¨å°†æ¥ä¼šç»§ç»­å¢åŠ ã€‚

![](./assets/1.13.jpg)





```java
public interface Subject {
    void registerObserver(Observer o);

    void removeObserver(Observer o);

    void notifyObserver();
}
```

```java
public class WeatherData implements Subject {
    //è§‚å¯Ÿè€…
    private List<Observer> observers;
    private float temperature;
    private float humidity;
    private float pressure;

    public WeatherData() {
        observers = new ArrayList<>();
    }

    public void setMeasurements(float temperature, float humidity, float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        notifyObserver();
    }

    @Override
    public void registerObserver(Observer o) {
        observers.add(o);
    }

    @Override
    public void removeObserver(Observer o) {
        int i = observers.indexOf(o);
        if (i >= 0) {
            observers.remove(i);
        }
    }

    //é€šçŸ¥è§‚å¯Ÿè€…æ‰€æœ‰çš„æ”¹å˜
    @Override
    public void notifyObserver() {
        for (Observer o : observers) {
            o.update(temperature, humidity, pressure);
        }
    }
}
```

```java
public interface Observer {
    void update(float temp, float humidity, float pressure);
}
```

```java
public class StatisticsDisplay implements Observer {

    public StatisticsDisplay(Subject weatherData) {
        weatherData.registerObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        System.out.println("StatisticsDisplay.update: " + temp + " " + humidity + " " + pressure);
    }
}
```

```java
public class CurrentConditionsDisplay implements Observer {

    public CurrentConditionsDisplay(Subject weatherData) {
        weatherData.registerObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        System.out.println("CurrentConditionsDisplay.update: " + temp + " " + humidity + " " + pressure);
    }
}
```



æµ‹è¯•ï¼š

```java
public class WeatherStation {
    public static void main(String[] args) {
        WeatherData weatherData = new WeatherData();
        CurrentConditionsDisplay currentConditionsDisplay = new CurrentConditionsDisplay(weatherData);
        StatisticsDisplay statisticsDisplay = new StatisticsDisplay(weatherData);

        weatherData.setMeasurements(0, 0, 0);
        weatherData.setMeasurements(1, 1, 1);
    }
}
```



```html
CurrentConditionsDisplay.update: 0.0 0.0 0.0
StatisticsDisplay.update: 0.0 0.0 0.0
CurrentConditionsDisplay.update: 1.0 1.0 1.0
StatisticsDisplay.update: 1.0 1.0 1.0
```



### åº”ç”¨åœºæ™¯

è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªæ‰©å±•åº”ç”¨æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚

![](./assets/1.14.png)

**è§‚å¯Ÿè€…æ¨¡å¼ï¼š**è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ç›´æ¥è®¢é˜…ï¼ˆSubscribeï¼‰ä¸»é¢˜ï¼ˆSubjectï¼‰ï¼Œè€Œå½“ä¸»é¢˜è¢«æ¿€æ´»çš„æ—¶å€™ï¼Œä¼šè§¦å‘ï¼ˆFire Eventï¼‰è§‚å¯Ÿè€…é‡Œçš„äº‹ä»¶ã€‚ 

**å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼š**è®¢é˜…è€…ï¼ˆSubscriberï¼‰æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶æ³¨å†Œï¼ˆSubscribeï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼ˆTopicï¼‰ï¼Œå½“å‘å¸ƒè€…ï¼ˆPublisherï¼‰å‘å¸ƒè¯¥äº‹ä»¶ï¼ˆPublish  topicï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒåº¦ï¼ˆFire Eventï¼‰è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚

åŒºåˆ«ï¼š

è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼æœ‰ä¸ªäº‹ä»¶è°ƒåº¦ä¸­å¿ƒã€‚

è§‚å¯Ÿè€…æ¨¡å¼ç”±å…·ä½“ç›®æ ‡è°ƒåº¦ï¼Œæ¯ä¸ªè¢«è®¢é˜…çš„ç›®æ ‡é‡Œé¢éƒ½éœ€è¦æœ‰å¯¹è§‚å¯Ÿè€…çš„å¤„ç†ï¼Œè¿™ç§å¤„ç†æ–¹å¼æ¯”è¾ƒç›´æ¥ç²—æš´ï¼Œä½†æ˜¯ä¼šé€ æˆä»£ç çš„å†—ä½™ã€‚

è€Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ç»Ÿä¸€ç”±è°ƒåº¦ä¸­å¿ƒè¿›è¡Œå¤„ç†ï¼Œè®¢é˜…è€…å’Œå‘å¸ƒè€…äº’ä¸å¹²æ‰°ï¼Œæ¶ˆé™¤äº†å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´çš„ä¾èµ–ã€‚è¿™æ ·ä¸€æ–¹é¢å®ç°äº†è§£è€¦ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„ä¸€äº›æ§åˆ¶ã€‚æ¯”å¦‚å‘å¸ƒè€…å‘å¸ƒäº†å¾ˆå¤šæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸æƒ³æ‰€æœ‰çš„è®¢é˜…è€…éƒ½æ¥æ”¶åˆ°ï¼Œå°±å¯ä»¥åœ¨è°ƒåº¦ä¸­å¿ƒåšä¸€äº›å¤„ç†ï¼Œç±»ä¼¼äºæƒé™æ§åˆ¶ä¹‹ç±»çš„ã€‚è¿˜å¯ä»¥åšä¸€äº›èŠ‚æµæ“ä½œã€‚



## 2 ç­–ç•¥

### Intent

 ç­–ç•¥æ¨¡å¼æ˜¯å¯¹ç®—æ³•çš„åŒ…è£…,æŠŠä½¿ç”¨ç®—æ³•çš„è´£ä»»å’Œç®—æ³•æœ¬èº«åˆ†éš”å¼€,å§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡ç®¡ç†ã€‚ 

**æ ¹æ®ä¼ å…¥çš„å¯¹è±¡ç±»å‹ï¼Œå°±å¯ä»¥ç¡®å®šåœ¨ç®—æ³•åŒ…è£…ç±»ä¸­è°ƒç”¨å“ªä¸€ä¸ªç®—æ³•ã€‚æ‰€ä»¥å¦‚æœè¦å¢åŠ ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œåªè¦è®©æ­¤ç±»å®ç°æŒ‡å®šæ¥å£å¹¶ä¸”å®ç°ç›¸åº”æ–¹æ³•å°±è¡Œäº†ã€‚**

### Class Diagram

- Strategy æ¥å£å®šä¹‰äº†ä¸€ä¸ªç®—æ³•æ—ï¼Œå®ƒä»¬éƒ½å®ç°äº†  behavior() æ–¹æ³•ã€‚
- Context æ˜¯ä½¿ç”¨åˆ°è¯¥ç®—æ³•æ—çš„ç±»ï¼Œå…¶ä¸­çš„ doSomething() æ–¹æ³•ä¼šè°ƒç”¨ behavior()ï¼ŒsetStrategy(Strategy) æ–¹æ³•å¯ä»¥åŠ¨æ€åœ°æ”¹å˜ strategy å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½åŠ¨æ€åœ°æ”¹å˜ Context æ‰€ä½¿ç”¨çš„ç®—æ³•ã€‚

![](./assets/1.19.png)


ç­–ç•¥æ¨¡å¼æœ¬è´¨æ˜¯å°†ç›¸åŒçš„è¡Œä¸ºæŠ½è±¡èšåˆåŒ–
ç­–ç•¥æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥å°è£…ä¸€ç»„å¯ä»¥äº’ç›¸æ›¿ä»£çš„ç®—æ³•æ—ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°å»æ›¿æ¢ Context ä½¿ç”¨çš„ç®—æ³•ã€‚

### Implementation

è®¾è®¡ä¸€ä¸ªé¸­å­ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°æ”¹å˜å«å£°ã€‚è¿™é‡Œçš„ç®—æ³•æ—æ˜¯é¸­å­çš„å«å£°è¡Œä¸ºã€‚

```java
public interface QuackBehavior {
    void quack();
}
```

```java
public class Quack implements QuackBehavior {
    @Override
    public void quack() {
        System.out.println("quack!");
    }
}
```

```java
public class Squeak implements QuackBehavior{
    @Override
    public void quack() {
        System.out.println("squeak!");
    }
}
```

```java
public class Duck {

    private QuackBehavior quackBehavior;

    public void performQuack() {
        if (quackBehavior != null) {
            quackBehavior.quack();
        }
    }

    public void setQuackBehavior(QuackBehavior quackBehavior) {
        this.quackBehavior = quackBehavior;
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        Duck duck = new Duck();
        duck.setQuackBehavior(new Squeak());
        duck.performQuack();
        duck.setQuackBehavior(new Quack());
        duck.performQuack();
    }
}
```

```html
squeak!
quack!
```


### åº”ç”¨åœºæ™¯

ç”µå•†ç½‘ç«™æ”¯ä»˜æ–¹å¼ï¼Œä¸€èˆ¬åˆ†ä¸ºé“¶è”ã€å¾®ä¿¡ã€æ”¯ä»˜å®ï¼Œå¯ä»¥é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œä¸ºæ¯ä¸€ç§æ–¹å¼ï¼Œä½œä¸ºä¸€ç§æ”¯ä»˜æ–¹å¼çš„å®ç°ï¼Œå¦‚æœå“ªä¸€ä¸ªæ”¯ä»˜æ–¹å¼æ–¹å¼ï¼Œå‘ç”Ÿäº†å˜åŒ–ï¼Œåªè¦ä¿®æ”¹å¯¹åº”çš„å®ç°å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹è°ƒç”¨çš„å®¢æˆ·ç«¯

å¦‚æœå¼•å…¥æ–°çš„æ”¯ä»˜ï¼Œå¦‚ä¸‡é‡Œé€šæ”¯ä»˜ï¼Œå¢åŠ ä¸€ä¸ªå¯¹åº”çš„ä¸‡é‡Œé€šæ”¯ä»˜**å®ç°ç±»**ï¼Œéµå¾ªäº†å¼€é—­åŸåˆ™ã€‚



## 3 æ¨¡æ¿

### Intent

å®šä¹‰ç®—æ³•æ¡†æ¶ï¼Œå¹¶å°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ï¼Œå¤ç”¨é‚£äº›ç›¸åŒæ­¥éª¤çš„ä»£ç ã€‚

é€šè¿‡æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ï¼Œè€Œä¸ç”¨æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚

### ä½œç”¨
å¤ç”¨å’Œæ‰©å±•ã€‚
æ‰©å±•ï¼šä»£ç çš„æ‰©å±•æ€§ï¼Œè€Œæ˜¯æŒ‡æ¡†æ¶çš„æ‰©å±•æ€§ã€‚

### Class Diagram

![](./assets/1.20.png)

### Implementation

å†²å’–å•¡å’Œå†²èŒ¶éƒ½æœ‰ç±»ä¼¼çš„æµç¨‹ï¼Œä½†æ˜¯æŸäº›æ­¥éª¤ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œè¦æ±‚å¤ç”¨é‚£äº›ç›¸åŒæ­¥éª¤çš„ä»£ç ã€‚

![](./assets/1.21.png)

```java
public abstract class CaffeineBeverage {

    final void prepareRecipe() {
        boilWater();
        brew();
        pourInCup();
        addCondiments();
    }

    abstract void brew();

    abstract void addCondiments();

    void boilWater() {
        System.out.println("boilWater");
    }

    void pourInCup() {
        System.out.println("pourInCup");
    }
}
```

```java
public class Coffee extends CaffeineBeverage {
    @Override
    void brew() {
        System.out.println("Coffee.brew");
    }

    @Override
    void addCondiments() {
        System.out.println("Coffee.addCondiments");
    }
}
```

```java
public class Tea extends CaffeineBeverage {
    @Override
    void brew() {
        System.out.println("Tea.brew");
    }

    @Override
    void addCondiments() {
        System.out.println("Tea.addCondiments");
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        CaffeineBeverage caffeineBeverage = new Coffee();
        caffeineBeverage.prepareRecipe();
        System.out.println("-----------");
        caffeineBeverage = new Tea();
        caffeineBeverage.prepareRecipe();
    }
}
```

```html
boilWater
Coffee.brew
pourInCup
Coffee.addCondiments
-----------
boilWater
Tea.brew
pourInCup
Tea.addCondiments
```
### go
```go
package doc

import "fmt"

type DocSuper struct {
    GetContent func() string
}

func (d DocSuper) DoOperate() {
    fmt.Println("å¯¹è¿™ä¸ªæ–‡æ¡£åšäº†ä¸€äº›å¤„ç†,æ–‡æ¡£æ˜¯:", d.GetContent())
}

----------
package doc

type LocalDoc struct {
    DocSuper
}

func NewLocalDoc() *LocalDoc {
    c := new(LocalDoc)
    c.DocSuper.GetContent = c.GetContent
    return c
}

func (e *LocalDoc) GetContent() string {
    return "this is a LocalDoc."
}
--------
package main

import . "doc"

func main() {
    netDoc := NewNetDoc()
    netDoc.DoOperate()
}
```





# :mushroom: ç»“æ„å‹

## 1 é€‚é…å™¨ï¼ˆAdapterï¼‰

### Intent

æŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£åŸå› ä¸åŒ¹é…è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿä¸€èµ·å·¥ä½œ 



### Class Diagram

![](./assets/1.25.png) 

**è§’è‰²ï¼š**

- ç›®æ ‡æ¥å£ï¼šTargetï¼Œè¯¥è§’è‰²æŠŠå…¶ä»–ç±»è½¬æ¢ä¸ºæˆ‘ä»¬æœŸæœ›çš„æ¥å£
- è¢«é€‚é…è€…: Adaptee åŸæœ‰çš„æ¥å£ï¼Œä¹Ÿæ˜¯å¸Œæœ›è¢«æ”¹å˜çš„æ¥å£
- **é€‚é…å™¨**ï¼š Adapter, å°†è¢«é€‚é…è€…å’Œç›®æ ‡æ¥å£ç»„åˆåˆ°ä¸€èµ·çš„ç±»

å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªé€‚é…å™¨ç»§æ‰¿ç›®æ ‡æ¥å£ï¼Œç„¶ååœ¨é€‚é…å™¨ä¸­è°ƒç”¨è¢«é€‚é…è€…çš„ä»£ç ã€‚
æœ¬è´¨æŠŠè¢«é€‚é…è€…ç»„åˆè¿‡æ¥ï¼Œå½“å‰ç±»çš„æ–¹æ³•æ¥å£è°ƒç”¨æ—¶ï¼Œå¯¹è¢«é€‚é…è€…æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚


### Implementation

é¸­å­ï¼ˆDuckï¼‰å’Œç«é¸¡ï¼ˆTurkeyï¼‰æ‹¥æœ‰ä¸åŒçš„å«å£°ï¼ŒDuck çš„å«å£°è°ƒç”¨ quack() æ–¹æ³•ï¼Œè€Œ Turkey è°ƒç”¨ gobble() æ–¹æ³•ã€‚

è¦æ±‚å°† Turkey çš„ gobble() æ–¹æ³•é€‚é…æˆ Duck çš„ quack() æ–¹æ³•ï¼Œä»è€Œè®©ç«é¸¡å†’å……é¸­å­ï¼

```java
public interface Duck {
    void quack();
}
```

```java
public interface Turkey {
    void gobble();
}
```

```java
public class WildTurkey implements Turkey {
    @Override
    public void gobble() {
        System.out.println("gobble!");
    }
}
```

```java
public class TurkeyAdapter implements Duck {
    Turkey turkey;

    public TurkeyAdapter(Turkey turkey) {
        this.turkey = turkey;
    }

    @Override
    public void quack() {
        turkey.gobble();
    }
}
```

```java
public class Client {
    public static void main(String[] args) {
        Turkey turkey = new WildTurkey();
        Duck duck = new TurkeyAdapter(turkey);
        duck.quack();
    }
}
```



### åº”ç”¨åœºæ™¯

[åšå®¢ï¼Œå†™çš„è¶…çº§å¥½](https://www.imooc.com/article/15110)

é€‚é…å™¨æ¨¡å¼ä»**å®ç°æ–¹å¼**ä¸Šåˆ†ä¸ºä¸¤ç§ï¼Œ**ç±»é€‚é…å™¨å’Œå¯¹è±¡é€‚é…å™¨**ï¼Œè¿™ä¸¤ç§çš„åŒºåˆ«åœ¨äºå®ç°æ–¹å¼ä¸Šçš„ä¸åŒï¼Œä¸€ç§é‡‡ç”¨ç»§æ‰¿ï¼Œä¸€ç§é‡‡ç”¨ç»„åˆçš„æ–¹å¼ã€‚  

å¦å¤–ä»**ä½¿ç”¨ç›®çš„**ä¸Šæ¥è¯´ï¼Œä¹Ÿå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œ**ç‰¹æ®Šé€‚é…å™¨å’Œç¼ºçœé€‚é…å™¨**ï¼Œä¸€ç§ä¸ºäº†å¤ç”¨åŸæœ‰çš„ä»£ç å¹¶é€‚é…å½“å‰çš„æ¥å£ï¼Œä¸€ç§ä¸ºäº†æä¾›ç¼ºçœçš„å®ç°ï¼Œé¿å…å­ç±»éœ€è¦å®ç°ä¸è¯¥å®ç°çš„æ–¹æ³•ã€‚ 



## 2 è£…é¥°/åŒ…è£…ï¼ˆDecoratorï¼‰

### Intent

ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ åŠŸèƒ½ã€‚
ç¬¬ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„åœ°æ–¹æ˜¯ï¼šè£…é¥°å™¨ç±»å’ŒåŸå§‹ç±»ç»§æ‰¿åŒæ ·çš„çˆ¶ç±»ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¯¹åŸå§‹ç±»â€œåµŒå¥—â€å¤šä¸ªè£…é¥°å™¨ç±»
ç¬¬äºŒä¸ªæ¯”è¾ƒç‰¹æ®Šçš„åœ°æ–¹æ˜¯ï¼šè£…é¥°å™¨ç±»æ˜¯å¯¹åŠŸèƒ½çš„å¢å¼ºï¼Œè¿™ä¹Ÿæ˜¯è£…é¥°å™¨æ¨¡å¼åº”ç”¨åœºæ™¯çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹

### Class Diagram

è£…é¥°æ¨¡å¼æŒ‡çš„æ˜¯åœ¨ä¸å¿…æ”¹å˜åŸç±»æ–‡ä»¶å’Œä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ã€‚å®ƒæ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è£…é¥°æ¥åŒ…è£¹çœŸå®çš„å¯¹è±¡ã€‚ 

![](./assets/1.32.png)

### Implementation

è®¾è®¡ä¸åŒç§ç±»çš„é¥®æ–™ï¼Œé¥®æ–™å¯ä»¥æ·»åŠ é…æ–™ï¼Œæ¯”å¦‚å¯ä»¥æ·»åŠ ç‰›å¥¶ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ·»åŠ æ–°é…æ–™ã€‚æ¯å¢åŠ ä¸€ç§é…æ–™ï¼Œè¯¥é¥®æ–™çš„ä»·æ ¼å°±ä¼šå¢åŠ ï¼Œè¦æ±‚è®¡ç®—ä¸€ç§é¥®æ–™çš„ä»·æ ¼ã€‚

ä¸‹å›¾è¡¨ç¤ºåœ¨ DarkRoast é¥®æ–™ä¸Šæ–°å¢æ–°æ·»åŠ  Mocha é…æ–™ï¼Œä¹‹ååˆæ·»åŠ äº† Whip é…æ–™ã€‚DarkRoast è¢« Mocha åŒ…è£¹ï¼ŒMocha åˆè¢« Whip åŒ…è£¹ã€‚å®ƒä»¬éƒ½ç»§æ‰¿è‡ªç›¸åŒçˆ¶ç±»ï¼Œéƒ½æœ‰ cost() æ–¹æ³•ï¼Œå¤–å±‚ç±»çš„ cost() æ–¹æ³•è°ƒç”¨äº†å†…å±‚ç±»çš„ cost() æ–¹æ³•ã€‚

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/c9cfd600-bc91-4f3a-9f99-b42f88a5bb24.jpg" width="600"/> </div><br>

```java
public interface Beverage {
    double cost();
}
```

```java
public class DarkRoast implements Beverage {
    @Override
    public double cost() {
        return 1;
    }
}
```

```java
public class HouseBlend implements Beverage {
    @Override
    public double cost() {
        return 1;
    }
}
```

```java
public abstract class CondimentDecorator implements Beverage {
    protected Beverage beverage;
}
```

```java
public class Milk extends CondimentDecorator {

    public Milk(Beverage beverage) {
        this.beverage = beverage;
    }

    @Override
    public double cost() {
        return 1 + beverage.cost();
    }
}
```

```java
public class Mocha extends CondimentDecorator {

    public Mocha(Beverage beverage) {
        this.beverage = beverage;
    }

    @Override
    public double cost() {
        return 1 + beverage.cost();
    }
}
```

```java
public class Client {

    public static void main(String[] args) {
        Beverage beverage = new HouseBlend();
        beverage = new Mocha(beverage);
        beverage = new Milk(beverage);
        System.out.println(beverage.cost());
    }
}
```

```html
3.0
```
```java
// è£…é¥°å™¨æ¨¡å¼çš„ä»£ç ç»“æ„(ä¸‹é¢çš„æ¥å£ä¹Ÿå¯ä»¥æ›¿æ¢æˆæŠ½è±¡ç±»)
public interface IA {
  void f();
}
public class A impelements IA {
  public void f() { //... }
}
public class ADecorator impements IA {
  private IA a;
  public ADecorator(IA a) {
    this.a = a;
  }
  
  public void f() {
    // åŠŸèƒ½å¢å¼ºä»£ç 
    a.f();
    // åŠŸèƒ½å¢å¼ºä»£ç 
  }
}
```

### è®¾è®¡åŸåˆ™

ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼šä¹Ÿå°±æ˜¯æ·»åŠ æ–°åŠŸèƒ½æ—¶ä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚é¥®æ–™å¯ä»¥åŠ¨æ€æ·»åŠ æ–°çš„é…æ–™ï¼Œè€Œä¸éœ€è¦å»ä¿®æ”¹é¥®æ–™çš„ä»£ç ã€‚

ä¸å¯èƒ½æŠŠæ‰€æœ‰çš„ç±»è®¾è®¡æˆéƒ½æ»¡è¶³è¿™ä¸€åŸåˆ™ï¼Œåº”å½“æŠŠè¯¥åŸåˆ™åº”ç”¨äºæœ€æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜çš„åœ°æ–¹ã€‚




## 3 ä»£ç†ï¼ˆProxyï¼‰

### Intent

[æ¨èåšå®¢](https://segmentfault.com/a/1190000019433930?utm_source=tag-newest)

åœ¨ç›´æ¥è®¿é—®å¯¹è±¡æ—¶å¸¦æ¥çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼šè¦è®¿é—®çš„å¯¹è±¡åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šã€‚åœ¨é¢å‘å¯¹è±¡ç³»ç»Ÿä¸­ï¼Œæœ‰äº›å¯¹è±¡ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚å¯¹è±¡åˆ›å»ºå¼€é”€å¾ˆå¤§ï¼Œæˆ–è€…æŸäº›æ“ä½œéœ€è¦å®‰å…¨æ§åˆ¶ï¼Œæˆ–è€…éœ€è¦è¿›ç¨‹å¤–çš„è®¿é—®ï¼‰ï¼Œç›´æ¥è®¿é—®ä¼šç»™ä½¿ç”¨è€…æˆ–è€…ç³»ç»Ÿç»“æ„å¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¿é—®æ­¤å¯¹è±¡æ—¶åŠ ä¸Šä¸€ä¸ªå¯¹æ­¤å¯¹è±¡çš„è®¿é—®å±‚ã€‚ 

å‡å¦‚è¯·æ±‚æ–¹å¾ˆé›·åŒï¼Œå¯ä»¥åŠ ä¸€ä¸ªæŠ½è±¡å±‚ç»Ÿä¸€ç®¡ç†ï¼Œè¿˜å¯ä»¥åŠ ä¸€äº›æ§åˆ¶ï¼Œå¾ˆæ–¹ä¾¿ã€‚

### Class Diagram

ä»£ç†æœ‰ä»¥ä¸‹å››ç±»ï¼š

- è¿œç¨‹ä»£ç†ï¼ˆRemote Proxyï¼‰ï¼šæ§åˆ¶å¯¹è¿œç¨‹å¯¹è±¡ï¼ˆä¸åŒåœ°å€ç©ºé—´ï¼‰çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£å°†è¯·æ±‚åŠå…¶å‚æ•°è¿›è¡Œç¼–ç ï¼Œå¹¶å‘ä¸åŒåœ°å€ç©ºé—´ä¸­çš„å¯¹è±¡å‘é€å·²ç»ç¼–ç çš„è¯·æ±‚ã€‚
- è™šæ‹Ÿä»£ç†ï¼ˆVirtual Proxyï¼‰ï¼šæ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç¼“å­˜å®ä½“çš„é™„åŠ ä¿¡æ¯ï¼Œä»¥ä¾¿å»¶è¿Ÿå¯¹å®ƒçš„è®¿é—®ï¼Œä¾‹å¦‚åœ¨ç½‘ç«™åŠ è½½ä¸€ä¸ªå¾ˆå¤§å›¾ç‰‡æ—¶ï¼Œä¸èƒ½é©¬ä¸Šå®Œæˆï¼Œå¯ä»¥ç”¨è™šæ‹Ÿä»£ç†ç¼“å­˜å›¾ç‰‡çš„å¤§å°ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆä¸€å¼ ä¸´æ—¶å›¾ç‰‡ä»£æ›¿åŸå§‹å›¾ç‰‡ã€‚
- ä¿æŠ¤ä»£ç†ï¼ˆProtection Proxyï¼‰ï¼šæŒ‰æƒé™æ§åˆ¶å¯¹è±¡çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦å…·æœ‰å®ç°ä¸€ä¸ªè¯·æ±‚æ‰€å¿…é¡»çš„è®¿é—®æƒé™ã€‚
- æ™ºèƒ½ä»£ç†ï¼ˆSmart Referenceï¼‰ï¼šå–ä»£äº†ç®€å•çš„æŒ‡é’ˆï¼Œå®ƒåœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œä¸€äº›é™„åŠ æ“ä½œï¼šè®°å½•å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼›å½“ç¬¬ä¸€æ¬¡å¼•ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†å®ƒè£…å…¥å†…å­˜ï¼›åœ¨è®¿é—®ä¸€ä¸ªå®é™…å¯¹è±¡å‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»é”å®šäº†å®ƒï¼Œä»¥ç¡®ä¿å…¶å®ƒå¯¹è±¡ä¸èƒ½æ”¹å˜å®ƒã€‚

å¦å¤–ä¸€ç§åˆ†ç±»ï¼š
- é™æ€ä»£ç†
- åŠ¨æ€ä»£ç†

åº”ç”¨åœºæ™¯ï¼š
ä»£ç†æ¨¡å¼æœ€å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯å°±æ˜¯ï¼Œåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­å¼€å‘ä¸€äº›éåŠŸèƒ½æ€§éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šç›‘æ§ã€ç»Ÿè®¡ã€é‰´æƒã€é™æµã€äº‹åŠ¡ã€å¹‚ç­‰ã€æ—¥å¿—ã€‚æˆ‘ä»¬å°†è¿™äº›é™„åŠ åŠŸèƒ½ä¸ä¸šåŠ¡åŠŸèƒ½è§£è€¦ï¼Œæ”¾åˆ°ä»£ç†ç±»ä¸­ç»Ÿä¸€å¤„ç†ï¼Œè®©ç¨‹åºå‘˜åªéœ€è¦å…³æ³¨ä¸šåŠ¡æ–¹é¢çš„å¼€å‘
RPC æ¡†æ¶ä¹Ÿå¯ä»¥çœ‹ä½œä¸€ç§ä»£ç†æ¨¡å¼ï¼Œé€šè¿‡è¿œç¨‹ä»£ç†ï¼Œå°†ç½‘ç»œé€šä¿¡ã€æ•°æ®ç¼–è§£ç ç­‰ç»†èŠ‚éšè—èµ·æ¥ã€‚


è§’è‰²è¯´æ˜ï¼š

* Subjectï¼šå®šä¹‰äº†RealSubjectå’ŒProxyçš„å…±ç”¨æ¥å£ï¼Œè¿™æ ·å°±åœ¨ä»»ä½•ä½¿ç”¨RealSubjectçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨Porxy
* RealSubjectï¼šå®šä¹‰äº†Proxyæ‰€ä»£è¡¨çš„çš„çœŸå®å®ä½“
* Proxyï¼šä¿å­˜ä¸€ä¸ªå¼•ç”¨ä½¿å¾—ä»£ç†å¯ä»¥è®¿é—®å®ä½“ï¼Œå¹¶æä¾›ä¸€ä¸ªä¸Subjectçš„æ¥å£ç›¸åŒçš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å°±å¯ä»¥ç”¨æ¥æ›¿ä»£å®ä½“


```java

public interface IUserController {
  UserVo login(String telephone, String password);
  UserVo register(String telephone, String password);
}

public class UserController implements IUserController {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...

  @Override
  public UserVo login(String telephone, String password) {
    //...çœç•¥loginé€»è¾‘...
    //...è¿”å›UserVoæ•°æ®...
  }

  @Override
  public UserVo register(String telephone, String password) {
    //...çœç•¥registeré€»è¾‘...
    //...è¿”å›UserVoæ•°æ®...
  }
}

public class UserControllerProxy implements IUserController {
  private MetricsCollector metricsCollector;
  private UserController userController;

  public UserControllerProxy(UserController userController) {
    this.userController = userController;
    this.metricsCollector = new MetricsCollector();
  }

  @Override
  public UserVo login(String telephone, String password) {
    long startTimestamp = System.currentTimeMillis();

    // å§”æ‰˜
    UserVo userVo = userController.login(telephone, password);

    long endTimeStamp = System.currentTimeMillis();
    long responseTime = endTimeStamp - startTimestamp;
    RequestInfo requestInfo = new RequestInfo("login", responseTime, startTimestamp);
    metricsCollector.recordRequest(requestInfo);

    return userVo;
  }

  @Override
  public UserVo register(String telephone, String password) {
    long startTimestamp = System.currentTimeMillis();

    UserVo userVo = userController.register(telephone, password);

    long endTimeStamp = System.currentTimeMillis();
    long responseTime = endTimeStamp - startTimestamp;
    RequestInfo requestInfo = new RequestInfo("register", responseTime, startTimestamp);
    metricsCollector.recordRequest(requestInfo);

    return userVo;
  }
}

//UserControllerProxyä½¿ç”¨ä¸¾ä¾‹
//å› ä¸ºåŸå§‹ç±»å’Œä»£ç†ç±»å®ç°ç›¸åŒçš„æ¥å£ï¼Œæ˜¯åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹
//å°†UserControllerç±»å¯¹è±¡æ›¿æ¢ä¸ºUserControllerProxyç±»å¯¹è±¡ï¼Œä¸éœ€è¦æ”¹åŠ¨å¤ªå¤šä»£ç 
IUserController userController = new UserControllerProxy(new UserController());
```


